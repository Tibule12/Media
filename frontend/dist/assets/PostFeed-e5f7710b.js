import{_ as x,h as b,r as k,o as r,c as i,a as e,b as c,w as _,f as m,k as P,v as F,g,F as u,j as y,d as v,t as p}from"./index-b19461a9.js";const w={data(){return{posts:[],sortOrder:"newest",authorFilter:"",fetchTimeout:null,loading:!1}},watch:{sortOrder(){this.fetchPosts()},authorFilter(){this.fetchTimeout&&clearTimeout(this.fetchTimeout),this.fetchTimeout=setTimeout(()=>{this.fetchPosts()},300)},$route(o,t){o.path==="/feed"&&this.fetchPosts()}},async created(){await this.fetchPosts()},beforeRouteEnter(o,t,f){f(d=>{d.fetchPosts(),d.$root.emitter&&d.$root.emitter.on("postCreated",()=>{setTimeout(()=>{d.fetchPosts()},500)})})},methods:{getMediaUrl(o){return o.startsWith("http://")||o.startsWith("https://")?o:`/media/${o}`},async fetchPosts(){this.loading=!0;try{const o={};this.sortOrder&&(o.sort=this.sortOrder),this.authorFilter&&(o.author=this.authorFilter);const t=await b.get("/api/posts/",{params:o});console.log("Fetched posts:",t.data),Array.isArray(t.data)?this.posts=t.data:t.data&&t.data.results?this.posts=t.data.results:this.posts=[]}catch(o){console.error("Failed to load posts",o)}finally{this.loading=!1}}}},T={class:"post-feed"},N={class:"filters",style:{"margin-bottom":"20px",display:"flex",gap:"20px","align-items":"center"}},O={key:0,class:"loader-container"},C={key:1},M={key:0,class:"no-posts"},V={class:"media-container"},U=["src"],L={key:1,controls:"",class:"post-video",preload:"metadata"},A=["src"];function B(o,t,f,d,l,a){const h=k("router-link");return r(),i("div",T,[t[10]||(t[10]=e("h2",null,"Posts",-1)),c(h,{to:"/create",class:"create-post-button"},{default:_(()=>t[4]||(t[4]=[v("Create New Post")])),_:1,__:[4]}),e("div",N,[t[6]||(t[6]=e("label",{for:"sort",style:{"font-weight":"bold",color:"#ff6f61"}},"Sort by:",-1)),m(e("select",{id:"sort","onUpdate:modelValue":t[0]||(t[0]=s=>l.sortOrder=s),onChange:t[1]||(t[1]=(...s)=>a.fetchPosts&&a.fetchPosts(...s)),style:{padding:"5px 10px","border-radius":"5px",border:"1px solid #ff6f61"}},t[5]||(t[5]=[e("option",{value:"newest"},"Newest",-1),e("option",{value:"oldest"},"Oldest",-1),e("option",{value:"most_liked"},"Most Liked",-1)]),544),[[P,l.sortOrder]]),t[7]||(t[7]=e("label",{for:"filter",style:{"font-weight":"bold",color:"#ff6f61"}},"Filter by author:",-1)),m(e("input",{id:"filter","onUpdate:modelValue":t[2]||(t[2]=s=>l.authorFilter=s),onInput:t[3]||(t[3]=(...s)=>a.fetchPosts&&a.fetchPosts(...s)),placeholder:"Author username",style:{padding:"5px 10px","border-radius":"5px",border:"1px solid #ff6f61"}},null,544),[[F,l.authorFilter]])]),l.loading?(r(),i("div",O,t[8]||(t[8]=[e("div",{class:"loader"},null,-1),e("p",null,"Loading posts...",-1)]))):(r(),i("div",C,[l.posts.length===0?(r(),i("div",M,"No posts yet.")):g("",!0),(r(!0),i(u,null,y(l.posts,s=>(r(),i("div",{key:s.id,class:"post"},[c(h,{to:"/post/"+s.id,class:"post-link"},{default:_(()=>[e("h3",null,p(s.author.username),1),e("p",null,p(s.content),1),e("div",V,[(r(!0),i(u,null,y(s.media,n=>(r(),i(u,{key:n.id},[n.media_type==="image"?(r(),i("img",{key:0,src:a.getMediaUrl(n.file),alt:"Post image",class:"post-image",loading:"lazy"},null,8,U)):n.media_type==="video"?(r(),i("video",L,[e("source",{src:a.getMediaUrl(n.file),type:"video/mp4"},null,8,A),t[9]||(t[9]=v(" Your browser does not support the video tag. "))])):g("",!0)],64))),128))])]),_:2},1032,["to"]),e("p",null,"Likes: "+p(s.likes?s.likes.length:0),1)]))),128))]))])}const D=x(w,[["render",B],["__scopeId","data-v-024328b0"]]);export{D as default};
