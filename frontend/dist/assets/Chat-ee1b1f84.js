import{_ as m,h as d,o as a,c as i,a as r,F as g,j as p,f as _,v,e as f,t as l,g as c,n as h,d as y}from"./index-b19461a9.js";const M={data(){return{conversations:[],selectedConversation:null,messages:[],newMessage:"",error:null,currentUserId:null,typingIndicator:"",typingTimeout:null,unreadMessages:{}}},async created(){try{const t=await d.get("/api/users/me/");this.currentUserId=t.data.id;const s=await d.get("/api/chat/conversations/");this.conversations=s.data,this.conversations.forEach(u=>{this.unreadMessages[u.id]=!1})}catch{this.error="Failed to load conversations."}},methods:{async selectConversation(t){this.selectedConversation=t,this.unreadMessages[t.id]=!1;try{const s=await d.get(`/api/chat/conversations/${t.id}/messages/`);this.messages=s.data}catch{this.error="Failed to load messages."}},async sendMessage(){if(this.newMessage.trim())try{const t=await d.post(`/api/chat/conversations/${this.selectedConversation.id}/messages/`,{content:this.newMessage});this.messages.push(t.data),this.newMessage=""}catch{this.error="Failed to send message."}},hasUnread(t){return this.unreadMessages[t]},notifyTyping(){this.typingIndicator="Typing...",clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.typingIndicator=""},2e3)}}},C={class:"chat-container"},w={class:"conversations"},T=["onClick"],k={key:0,class:"unread-indicator"},I={key:0,class:"messages"},x={key:0,class:"read-receipt"},U={key:0,class:"typing-indicator"};function F(t,s,u,N,n,o){return a(),i("div",C,[s[4]||(s[4]=r("h2",null,"Direct Messages",-1)),r("div",w,[r("ul",null,[(a(!0),i(g,null,p(n.conversations,e=>(a(),i("li",{key:e.id,onClick:V=>o.selectConversation(e),class:h({selected:n.selectedConversation&&n.selectedConversation.id===e.id})},[y(l(e.participantName)+" ",1),o.hasUnread(e.id)?(a(),i("span",k,"•")):c("",!0)],10,T))),128))])]),n.selectedConversation?(a(),i("div",I,[r("ul",null,[(a(!0),i(g,null,p(n.messages,e=>(a(),i("li",{key:e.id,class:h({"my-message":e.sender===n.currentUserId})},[r("strong",null,l(e.senderName)+":",1),y(" "+l(e.content)+" ",1),e.read?(a(),i("span",x,"✓")):c("",!0)],2))),128))]),r("form",{onSubmit:s[2]||(s[2]=f((...e)=>o.sendMessage&&o.sendMessage(...e),["prevent"]))},[_(r("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.newMessage=e),placeholder:"Type a message...",onInput:s[1]||(s[1]=(...e)=>o.notifyTyping&&o.notifyTyping(...e))},null,544),[[v,n.newMessage]]),s[3]||(s[3]=r("button",{type:"submit"},"Send",-1))],32),n.typingIndicator?(a(),i("div",U,l(n.typingIndicator),1)):c("",!0)])):c("",!0)])}const B=m(M,[["render",F],["__scopeId","data-v-ee971d23"]]);export{B as default};
